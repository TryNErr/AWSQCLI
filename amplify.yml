version: 1
backend:
  phases:
    build:
      commands:
        - "echo 'ðŸ”§ Amplify Gen 2 Backend Deployment'"
        - "cd amplify"
        - "npm install"
        - "npm run build"
        - "echo 'âœ… Backend compiled'"
frontend:
  phases:
    preBuild:
      commands:
        - "echo 'ðŸš€ Building React Frontend'"
        - "cd ../quizwiz-app/frontend"
        - "npm install"
        - "echo 'âœ… Dependencies installed'"
    build:
      commands:
        - "echo 'ðŸ”¨ Building React application...'"
        - "echo 'REACT_APP_API_URL=https://master.d210nlz7uk7hed.amplifyapp.com' > .env.production.local"
        - "echo 'REACT_APP_ENVIRONMENT=production' >> .env.production.local"
        - "echo 'GENERATE_SOURCEMAP=false' >> .env.production.local"
        - "npm run build"
        - "echo 'âœ… Build completed'"
    postBuild:
      commands:
        - "test -f build/index.html && echo 'âœ… Frontend ready' || exit 1"
  artifacts:
    baseDirectory: quizwiz-app/frontend/build
    files:
      - '**/*'
  cache:
    paths:
      - quizwiz-app/frontend/node_modules/**/*
      - amplify/node_modules/**/*
